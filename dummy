import os
from pathlib import Path
from PyPDF2 import PdfReader

# Set the input directory (where PDF files are located)
input_dir = "path_to_your_directory"

# Set the output directory for text files
output_dir = "path_to_text_files_directory"
Path(output_dir).mkdir(parents=True, exist_ok=True)  # Create output directory if it doesn't exist

# Function to convert PDF to text
def pdf_to_text(pdf_path, text_path):
    try:
        with open(pdf_path, "rb") as file:
            reader = PdfReader(file)
            text = ""
            for page in reader.pages:
                text += page.extract_text() or ""
        # Write the extracted text to a text file in the output directory
        with open(text_path, "w", encoding="utf-8") as text_file:
            text_file.write(text)
    except Exception as e:
        print(f"Failed to convert {pdf_path} to text: {e}")

# Walk through directories to find PDFs and convert them
for pdf_path in Path(input_dir).rglob("*.pdf"):
    # Generate relative path for the PDF
    relative_path = pdf_path.relative_to(input_dir)
    # Define output path for the text file in the output directory, maintaining subdirectory structure
    text_path = Path(output_dir) / relative_path.with_suffix(".txt")
    text_path.parent.mkdir(parents=True, exist_ok=True)  # Create subdirectories if they don't exist
    pdf_to_text(pdf_path, text_path)
    print(f"Converted {pdf_path} to {text_path}")
